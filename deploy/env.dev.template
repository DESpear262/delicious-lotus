# ===================================
# AI Video Generation Pipeline
# Development Environment Template
# ===================================
#
# SETUP INSTRUCTIONS:
# 1. Copy this file to .env in your deployment environment
# 2. Replace all placeholder values with actual credentials
# 3. Review all settings and adjust as needed
# 4. NEVER commit files with real credentials to git
#
# This template is for DEVELOPMENT/STAGING environments
# For production settings, use env.prod.template
#
# ===================================

# -----------------------------------
# Environment Identification
# -----------------------------------
# Environment type: development, staging, production
ENVIRONMENT=development

# Enable debug mode (verbose logging, detailed error messages)
# WARNING: Always set to false in production
DEBUG=true

# Logging level: debug, info, warning, error, critical
LOG_LEVEL=debug

# Log format: json (for structured logging) or text (human-readable)
LOG_FORMAT=text

# -----------------------------------
# Database Configuration (PostgreSQL)
# -----------------------------------
# REQUIRED: PostgreSQL connection details

# For local development (Docker Compose)
POSTGRES_DB=ai_video_pipeline
POSTGRES_USER=ai_video_user
POSTGRES_PASSWORD=CHANGE_ME_secure_dev_password_123
POSTGRES_HOST=postgres
POSTGRES_PORT=5432

# Full database URL (auto-constructed or specify manually)
# Format: postgresql://user:password@host:port/database
DATABASE_URL=postgresql://ai_video_user:CHANGE_ME_secure_dev_password_123@postgres:5432/ai_video_pipeline

# Connection pool settings
DB_POOL_SIZE=10
DB_MAX_OVERFLOW=20
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600

# -----------------------------------
# Redis Configuration
# -----------------------------------
# REQUIRED: Redis for job queuing and caching

# For local development (Docker Compose)
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=

# Full Redis URL
# Format: redis://[password@]host:port/db
REDIS_URL=redis://redis:6379/0

# Redis connection pool
REDIS_MAX_CONNECTIONS=50

# -----------------------------------
# Backend API Configuration
# -----------------------------------
# REQUIRED: Core application settings

# Port the backend API listens on
BACKEND_PORT=8000

# API base URL (for frontend to connect)
API_BASE_URL=http://localhost:8000

# Application secret key for sessions/JWT
# GENERATE: openssl rand -hex 32
SECRET_KEY=CHANGE_ME_generate_random_string_openssl_rand_hex_32

# JWT settings (if using token-based auth)
JWT_SECRET_KEY=CHANGE_ME_generate_different_random_string
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=60
JWT_REFRESH_TOKEN_EXPIRE_DAYS=7

# -----------------------------------
# CORS Configuration (Option B: Single Domain)
# -----------------------------------
# For Option B deployment (FastAPI serves static files)
# Single-origin setup simplifies CORS

# Allowed origins for CORS (comma-separated)
# For development: include localhost ports
# For production with Option B: same domain, so minimal CORS needed
ALLOWED_ORIGINS=http://localhost:5173,http://localhost:3000,http://localhost:8000

# Allow credentials in CORS requests
CORS_ALLOW_CREDENTIALS=true

# Allowed HTTP methods
CORS_ALLOW_METHODS=GET,POST,PUT,DELETE,PATCH,OPTIONS

# Allowed headers
CORS_ALLOW_HEADERS=*

# -----------------------------------
# AI Services Configuration (Replicate)
# -----------------------------------
# REQUIRED: Replicate API for AI model access

# Replicate API Token
# Get from: https://replicate.com/account/api-tokens
# Format: r8_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
REPLICATE_API_TOKEN=CHANGE_ME_your_replicate_api_token_here

# Model selection for development (cheaper/faster models)
REPLICATE_USE_CHEAP_MODELS=true
REPLICATE_MODEL_QUALITY_TIER=standard

# Model-specific settings
REPLICATE_IMAGE_MODEL=stability-ai/sdxl:latest
REPLICATE_VIDEO_MODEL=deforum/deforum_stable_diffusion:latest
REPLICATE_TIMEOUT_SECONDS=300

# API retry settings
REPLICATE_MAX_RETRIES=3
REPLICATE_RETRY_DELAY_SECONDS=5

# -----------------------------------
# AWS Configuration
# -----------------------------------
# OPTIONAL for dev (can use local storage)
# REQUIRED for staging/production

# AWS credentials
# Get from: AWS IAM Console
AWS_ACCESS_KEY_ID=CHANGE_ME_your_aws_access_key_id
AWS_SECRET_ACCESS_KEY=CHANGE_ME_your_aws_secret_access_key
AWS_REGION=us-east-1
AWS_DEFAULT_REGION=us-east-1

# S3 Bucket for video/asset storage
# Naming convention: ai-video-{env}-{random}
S3_BUCKET=ai-video-dev-bucket-12345
S3_UPLOADS_PREFIX=uploads/
S3_GENERATIONS_PREFIX=generations/
S3_COMPOSITIONS_PREFIX=compositions/
S3_TEMP_PREFIX=temp/

# S3 presigned URL expiration (seconds)
S3_PRESIGNED_URL_EXPIRY=3600

# ECR (Elastic Container Registry)
# Format: {account-id}.dkr.ecr.{region}.amazonaws.com/{repo-name}
ECR_REPOSITORY=CHANGE_ME_account_id.dkr.ecr.us-east-1.amazonaws.com/ai-video-backend

# ECS Configuration (for deployment)
ECS_CLUSTER=ai-video-dev-cluster
ECS_SERVICE=ai-video-dev-service
ECS_TASK_DEFINITION=ai-video-backend-dev

# -----------------------------------
# Storage Configuration
# -----------------------------------
# Toggle between local filesystem and S3

# Use local storage instead of S3 (useful for local dev without AWS)
USE_LOCAL_STORAGE=true

# Local storage path (when USE_LOCAL_STORAGE=true)
LOCAL_STORAGE_PATH=/app/storage

# Storage cleanup settings
STORAGE_CLEANUP_ENABLED=true
STORAGE_CLEANUP_TEMP_FILES_DAYS=1
STORAGE_CLEANUP_GENERATIONS_DAYS=7
STORAGE_CLEANUP_CRON=0 2 * * *

# -----------------------------------
# Video Processing Configuration (FFmpeg)
# -----------------------------------
# FFmpeg binary path (usually auto-detected)
FFMPEG_PATH=/usr/bin/ffmpeg
FFPROBE_PATH=/usr/bin/ffprobe

# Processing settings
FFMPEG_THREADS=4
FFMPEG_PRESET=medium
FFMPEG_LOG_LEVEL=info

# Output quality settings
OUTPUT_VIDEO_QUALITY=720p
OUTPUT_VIDEO_WIDTH=1280
OUTPUT_VIDEO_HEIGHT=720
OUTPUT_VIDEO_CODEC=libx264
OUTPUT_VIDEO_BITRATE=2M
OUTPUT_AUDIO_CODEC=aac
OUTPUT_AUDIO_BITRATE=128k
OUTPUT_AUDIO_SAMPLE_RATE=48000

# Video duration limits
MIN_VIDEO_DURATION=15
MAX_VIDEO_DURATION=180
MAX_AD_DURATION=60
MAX_MUSIC_VIDEO_DURATION=180

# Aspect ratio support
SUPPORTED_ASPECT_RATIOS=16:9,9:16,1:1

# -----------------------------------
# Job Processing Configuration (Celery)
# -----------------------------------
# Celery broker and result backend use Redis
CELERY_BROKER_URL=redis://redis:6379/0
CELERY_RESULT_BACKEND=redis://redis:6379/0

# Celery task settings
CELERY_TASK_ALWAYS_EAGER=false
CELERY_TASK_EAGER_PROPAGATES=true
CELERY_TASK_TRACK_STARTED=true
CELERY_TASK_TIME_LIMIT=1800
CELERY_TASK_SOFT_TIME_LIMIT=1500

# Worker settings
CELERY_WORKER_CONCURRENCY=4
CELERY_WORKER_PREFETCH_MULTIPLIER=1
CELERY_WORKER_MAX_TASKS_PER_CHILD=100

# Job limits
MAX_CONCURRENT_JOBS=5
JOB_TIMEOUT_SECONDS=1200
JOB_RETRY_MAX_ATTEMPTS=3
JOB_RETRY_DELAY_SECONDS=10

# Cleanup settings
CLEANUP_COMPLETED_JOBS_AFTER_DAYS=7
CLEANUP_FAILED_JOBS_AFTER_DAYS=3

# -----------------------------------
# Performance & Caching
# -----------------------------------
# Enable response caching
ENABLE_CACHING=true

# Cache TTL (time to live in seconds)
CACHE_TTL_SECONDS=3600
CACHE_AI_RESPONSES=true
CACHE_ASSET_METADATA=true

# Smart optimization
REUSE_SIMILAR_PROMPTS=true
PROMPT_SIMILARITY_THRESHOLD=0.85

# -----------------------------------
# Rate Limiting
# -----------------------------------
# Rate limit settings to prevent abuse
RATE_LIMIT_ENABLED=true
RATE_LIMIT_PER_MINUTE=60
RATE_LIMIT_PER_HOUR=1000
RATE_LIMIT_PER_DAY=10000

# Burst allowance
RATE_LIMIT_BURST=10

# -----------------------------------
# Security Settings
# -----------------------------------
# File upload restrictions
MAX_UPLOAD_SIZE_MB=100
MAX_UPLOAD_SIZE_BYTES=104857600

# Allowed file extensions (comma-separated, with dots)
ALLOWED_IMAGE_EXTENSIONS=.jpg,.jpeg,.png,.gif,.webp
ALLOWED_AUDIO_EXTENSIONS=.mp3,.wav,.m4a,.aac
ALLOWED_VIDEO_EXTENSIONS=.mp4,.mov,.avi,.webm
ALLOWED_UPLOAD_EXTENSIONS=.mp3,.wav,.m4a,.jpg,.jpeg,.png,.gif,.webp

# Input validation
MAX_PROMPT_LENGTH=2000
MIN_PROMPT_LENGTH=10
SANITIZE_USER_INPUT=true

# Session settings
SESSION_TIMEOUT_MINUTES=60
SESSION_COOKIE_SECURE=false
SESSION_COOKIE_HTTPONLY=true
SESSION_COOKIE_SAMESITE=lax

# -----------------------------------
# Monitoring & Logging
# -----------------------------------
# Sentry error tracking (optional for dev, recommended for production)
SENTRY_DSN=
SENTRY_ENVIRONMENT=development
SENTRY_TRACES_SAMPLE_RATE=0.1
SENTRY_ENABLED=false

# CloudWatch logging (for AWS environments)
CLOUDWATCH_LOG_GROUP=/aws/ecs/ai-video-dev
CLOUDWATCH_LOG_STREAM_PREFIX=backend
CLOUDWATCH_ENABLED=false

# Health check settings
HEALTH_CHECK_PATH=/health
HEALTH_CHECK_TIMEOUT=5

# Metrics
ENABLE_METRICS=true
METRICS_PORT=9090

# -----------------------------------
# Feature Flags
# -----------------------------------
# MVP Features (enabled for development)
ENABLE_AD_PIPELINE=true
ENABLE_MUSIC_VIDEO_PIPELINE=true

# Post-MVP Features (disabled by default)
ENABLE_TIMELINE_EDITOR=false
ENABLE_ADVANCED_TRANSITIONS=false
ENABLE_CUSTOM_FONTS=false
ENABLE_BATCH_PROCESSING=false
ENABLE_TEMPLATE_MARKETPLACE=false

# Experimental Features
ENABLE_EXPERIMENTAL_MODELS=true
ENABLE_BETA_FEATURES=true

# -----------------------------------
# Frontend Configuration (Option B)
# -----------------------------------
# For Option B deployment: FastAPI serves frontend static files

# Path to frontend build output (relative to backend root)
FRONTEND_BUILD_PATH=/app/frontend/dist

# Serve frontend from backend
SERVE_FRONTEND=true

# Frontend assets CDN (leave empty for local serving)
FRONTEND_CDN_URL=

# Static file caching (seconds)
STATIC_FILE_CACHE_MAX_AGE=3600

# -----------------------------------
# Cost Optimization
# -----------------------------------
# Development cost controls
USE_CHEAP_MODELS=true
MODEL_QUALITY_TIER=standard

# Clip generation limits
MAX_CLIPS_PER_AD=5
MAX_CLIPS_PER_MUSIC_VIDEO=20
DEFAULT_CLIPS_PER_AD=3
DEFAULT_CLIPS_PER_MUSIC_VIDEO=10

# API call optimization
BATCH_API_CALLS=true
MAX_BATCH_SIZE=5

# Smart reuse
ENABLE_ASSET_REUSE=true
ASSET_REUSE_SIMILARITY_THRESHOLD=0.9

# -----------------------------------
# Development Tools
# -----------------------------------
# Enable hot reload for development
HOT_RELOAD=true

# Enable auto-reload on code changes
AUTO_RELOAD=true

# API Documentation
ENABLE_DOCS=true
DOCS_URL=/docs
REDOC_URL=/redoc
OPENAPI_URL=/openapi.json

# Enable development endpoints
ENABLE_DEBUG_ENDPOINTS=true
ENABLE_TEST_ENDPOINTS=true

# Database migrations
AUTO_MIGRATE=true
AUTO_CREATE_TABLES=true

# -----------------------------------
# Testing Configuration
# -----------------------------------
# Test database (separate from dev database)
TEST_DATABASE_URL=postgresql://ai_video_user:CHANGE_ME_secure_dev_password_123@postgres:5432/ai_video_pipeline_test

# Test mode settings
RUN_TESTS_IN_PARALLEL=false
TEST_TIMEOUT_SECONDS=300

# Mock external services during testing
MOCK_REPLICATE_API=false
MOCK_AWS_SERVICES=false

# -----------------------------------
# Email/Notifications (Optional)
# -----------------------------------
# For error notifications and alerts
EMAIL_ENABLED=false
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=CHANGE_ME_your_email@gmail.com
SMTP_PASSWORD=CHANGE_ME_your_email_password
SMTP_FROM_EMAIL=noreply@ai-video-pipeline.com

# Alert recipients (comma-separated)
ALERT_EMAIL_RECIPIENTS=admin@example.com

# -----------------------------------
# Slack Notifications (Optional)
# -----------------------------------
SLACK_WEBHOOK_URL=
SLACK_CHANNEL=#ai-video-alerts
SLACK_ENABLED=false

# -----------------------------------
# Third-Party Integrations (Optional)
# -----------------------------------
# Add any additional service credentials here

# Example: Analytics service
ANALYTICS_API_KEY=
ANALYTICS_ENABLED=false

# Example: CDN service
CDN_API_KEY=
CDN_ENABLED=false
