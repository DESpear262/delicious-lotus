# ===================================
# AI Video Generation Pipeline
# Production Environment Template
# ===================================
#
# CRITICAL SECURITY INSTRUCTIONS:
# 1. NEVER commit this file with real credentials
# 2. Use AWS Secrets Manager or similar for sensitive values
# 3. All credentials must be strong, unique, and randomly generated
# 4. Review security settings thoroughly before deployment
# 5. Enable all monitoring and alerting systems
#
# This template is for PRODUCTION environments only
# For development settings, use env.dev.template
#
# ===================================

# -----------------------------------
# Environment Identification
# -----------------------------------
ENVIRONMENT=production

# CRITICAL: Always false in production
DEBUG=false

# Production logging (less verbose)
LOG_LEVEL=warning
LOG_FORMAT=json

# -----------------------------------
# Database Configuration (PostgreSQL RDS)
# -----------------------------------
# REQUIRED: Production database credentials
# IMPORTANT: Use AWS RDS for production, not container database

# RDS Instance endpoint
POSTGRES_DB=ai_video_pipeline_prod
POSTGRES_USER=CHANGE_ME_prod_db_user
POSTGRES_PASSWORD=CHANGE_ME_STRONG_RANDOM_PASSWORD_MIN_32_CHARS
POSTGRES_HOST=CHANGE_ME_your-rds-instance.xxxx.us-east-1.rds.amazonaws.com
POSTGRES_PORT=5432

# Full database URL
# Format: postgresql://user:password@host:port/database
DATABASE_URL=postgresql://CHANGE_ME_prod_db_user:CHANGE_ME_STRONG_RANDOM_PASSWORD_MIN_32_CHARS@CHANGE_ME_your-rds-instance.xxxx.us-east-1.rds.amazonaws.com:5432/ai_video_pipeline_prod

# Production connection pool (higher limits)
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=40
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600
DB_POOL_PRE_PING=true

# SSL for database connection (recommended for RDS)
DB_SSL_MODE=require

# -----------------------------------
# Redis Configuration (ElastiCache)
# -----------------------------------
# REQUIRED: Production Redis cluster
# IMPORTANT: Use AWS ElastiCache for production

# ElastiCache endpoint
REDIS_HOST=CHANGE_ME_your-redis-cluster.xxxx.cache.amazonaws.com
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=CHANGE_ME_redis_auth_token_if_enabled

# Full Redis URL
REDIS_URL=redis://:CHANGE_ME_redis_auth_token_if_enabled@CHANGE_ME_your-redis-cluster.xxxx.cache.amazonaws.com:6379/0

# Production connection pool (higher limits)
REDIS_MAX_CONNECTIONS=100

# SSL for Redis (if enabled in ElastiCache)
REDIS_SSL=true

# -----------------------------------
# Backend API Configuration
# -----------------------------------
# REQUIRED: Production application settings

# Port (typically 8000, but may vary based on ECS configuration)
BACKEND_PORT=8000

# API base URL (production domain)
# IMPORTANT: Update with actual production domain
API_BASE_URL=https://CHANGE_ME_your-production-domain.com

# Application secret keys
# CRITICAL: Generate with: openssl rand -hex 32
# NEVER reuse development secrets in production
SECRET_KEY=CHANGE_ME_GENERATE_STRONG_RANDOM_64_CHAR_STRING
JWT_SECRET_KEY=CHANGE_ME_GENERATE_DIFFERENT_STRONG_RANDOM_64_CHAR_STRING

# JWT settings (shorter expiration for production)
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=30
JWT_REFRESH_TOKEN_EXPIRE_DAYS=1

# -----------------------------------
# CORS Configuration (Production)
# -----------------------------------
# For Option B deployment: Same-origin, minimal CORS needed

# Allowed origins (production domain only)
# IMPORTANT: Update with actual production domain
ALLOWED_ORIGINS=https://CHANGE_ME_your-production-domain.com

# Strict CORS settings for production
CORS_ALLOW_CREDENTIALS=true
CORS_ALLOW_METHODS=GET,POST,PUT,DELETE,PATCH,OPTIONS
CORS_ALLOW_HEADERS=Content-Type,Authorization,X-Request-ID

# -----------------------------------
# AI Services Configuration (Replicate)
# -----------------------------------
# REQUIRED: Production Replicate API credentials

# Replicate API Token
# IMPORTANT: Use production API token with higher rate limits
# Get from: https://replicate.com/account/api-tokens
REPLICATE_API_TOKEN=CHANGE_ME_r8_production_replicate_token_here

# Production model settings (higher quality)
REPLICATE_USE_CHEAP_MODELS=false
REPLICATE_MODEL_QUALITY_TIER=premium

# Production-quality models
REPLICATE_IMAGE_MODEL=stability-ai/sdxl:latest
REPLICATE_VIDEO_MODEL=deforum/deforum_stable_diffusion:latest
REPLICATE_TIMEOUT_SECONDS=600

# Aggressive retry for production reliability
REPLICATE_MAX_RETRIES=5
REPLICATE_RETRY_DELAY_SECONDS=10

# -----------------------------------
# AWS Configuration (Production)
# -----------------------------------
# REQUIRED: Production AWS credentials
# RECOMMENDED: Use IAM roles for ECS tasks instead of keys when possible

# AWS credentials (prefer IAM roles over static keys)
# If using IAM roles, leave these empty
AWS_ACCESS_KEY_ID=CHANGE_ME_or_use_iam_role
AWS_SECRET_ACCESS_KEY=CHANGE_ME_or_use_iam_role
AWS_REGION=us-east-1
AWS_DEFAULT_REGION=us-east-1

# S3 Bucket (production)
# IMPORTANT: Enable versioning and lifecycle policies
S3_BUCKET=ai-video-prod-bucket-CHANGE_ME_unique_suffix
S3_UPLOADS_PREFIX=uploads/
S3_GENERATIONS_PREFIX=generations/
S3_COMPOSITIONS_PREFIX=compositions/
S3_TEMP_PREFIX=temp/

# S3 settings
S3_PRESIGNED_URL_EXPIRY=1800
S3_USE_ACCELERATE=true
S3_USE_PATH_STYLE=false

# ECR Repository
ECR_REPOSITORY=CHANGE_ME_account_id.dkr.ecr.us-east-1.amazonaws.com/ai-video-backend

# ECS Configuration
ECS_CLUSTER=ai-video-prod-cluster
ECS_SERVICE=ai-video-prod-service
ECS_TASK_DEFINITION=ai-video-backend-prod

# CloudWatch Log Group
CLOUDWATCH_LOG_GROUP=/aws/ecs/ai-video-prod
CLOUDWATCH_LOG_STREAM_PREFIX=backend
CLOUDWATCH_ENABLED=true

# -----------------------------------
# Storage Configuration
# -----------------------------------
# Production MUST use S3, not local storage
USE_LOCAL_STORAGE=false

# S3 lifecycle and cleanup
STORAGE_CLEANUP_ENABLED=true
STORAGE_CLEANUP_TEMP_FILES_DAYS=7
STORAGE_CLEANUP_GENERATIONS_DAYS=30
STORAGE_CLEANUP_CRON=0 3 * * *

# S3 encryption
S3_SERVER_SIDE_ENCRYPTION=AES256

# -----------------------------------
# Video Processing Configuration
# -----------------------------------
FFMPEG_PATH=/usr/bin/ffmpeg
FFPROBE_PATH=/usr/bin/ffprobe

# Production processing (optimized)
FFMPEG_THREADS=8
FFMPEG_PRESET=fast
FFMPEG_LOG_LEVEL=error

# Production quality settings (higher quality)
OUTPUT_VIDEO_QUALITY=720p
OUTPUT_VIDEO_WIDTH=1280
OUTPUT_VIDEO_HEIGHT=720
OUTPUT_VIDEO_CODEC=libx264
OUTPUT_VIDEO_BITRATE=3M
OUTPUT_VIDEO_PROFILE=high
OUTPUT_AUDIO_CODEC=aac
OUTPUT_AUDIO_BITRATE=192k
OUTPUT_AUDIO_SAMPLE_RATE=48000

# Duration limits (enforced)
MIN_VIDEO_DURATION=15
MAX_VIDEO_DURATION=180
MAX_AD_DURATION=60
MAX_MUSIC_VIDEO_DURATION=180

# Aspect ratios
SUPPORTED_ASPECT_RATIOS=16:9,9:16,1:1

# -----------------------------------
# Job Processing Configuration
# -----------------------------------
CELERY_BROKER_URL=redis://:CHANGE_ME_redis_auth_token_if_enabled@CHANGE_ME_your-redis-cluster.xxxx.cache.amazonaws.com:6379/0
CELERY_RESULT_BACKEND=redis://:CHANGE_ME_redis_auth_token_if_enabled@CHANGE_ME_your-redis-cluster.xxxx.cache.amazonaws.com:6379/0

# Production Celery settings
CELERY_TASK_ALWAYS_EAGER=false
CELERY_TASK_EAGER_PROPAGATES=false
CELERY_TASK_TRACK_STARTED=true
CELERY_TASK_TIME_LIMIT=3600
CELERY_TASK_SOFT_TIME_LIMIT=3300

# Production worker settings (more workers)
CELERY_WORKER_CONCURRENCY=8
CELERY_WORKER_PREFETCH_MULTIPLIER=2
CELERY_WORKER_MAX_TASKS_PER_CHILD=1000

# Production job limits
MAX_CONCURRENT_JOBS=20
JOB_TIMEOUT_SECONDS=3600
JOB_RETRY_MAX_ATTEMPTS=3
JOB_RETRY_DELAY_SECONDS=30

# Aggressive cleanup in production
CLEANUP_COMPLETED_JOBS_AFTER_DAYS=3
CLEANUP_FAILED_JOBS_AFTER_DAYS=1

# -----------------------------------
# Performance & Caching
# -----------------------------------
# Production caching (aggressive)
ENABLE_CACHING=true
CACHE_TTL_SECONDS=7200
CACHE_AI_RESPONSES=true
CACHE_ASSET_METADATA=true

# Smart optimization (enabled)
REUSE_SIMILAR_PROMPTS=true
PROMPT_SIMILARITY_THRESHOLD=0.90

# -----------------------------------
# Rate Limiting (Production - Stricter)
# -----------------------------------
RATE_LIMIT_ENABLED=true
RATE_LIMIT_PER_MINUTE=30
RATE_LIMIT_PER_HOUR=500
RATE_LIMIT_PER_DAY=5000

# Smaller burst for production
RATE_LIMIT_BURST=5

# -----------------------------------
# Security Settings (Production)
# -----------------------------------
# File upload restrictions (stricter)
MAX_UPLOAD_SIZE_MB=50
MAX_UPLOAD_SIZE_BYTES=52428800

# Allowed extensions (restrictive)
ALLOWED_IMAGE_EXTENSIONS=.jpg,.jpeg,.png,.webp
ALLOWED_AUDIO_EXTENSIONS=.mp3,.wav,.m4a
ALLOWED_VIDEO_EXTENSIONS=.mp4,.webm
ALLOWED_UPLOAD_EXTENSIONS=.mp3,.wav,.m4a,.jpg,.jpeg,.png,.webp

# Input validation (strict)
MAX_PROMPT_LENGTH=1500
MIN_PROMPT_LENGTH=20
SANITIZE_USER_INPUT=true

# Production session settings (secure)
SESSION_TIMEOUT_MINUTES=30
SESSION_COOKIE_SECURE=true
SESSION_COOKIE_HTTPONLY=true
SESSION_COOKIE_SAMESITE=strict

# HTTPS enforcement
FORCE_HTTPS=true

# Additional security headers
ENABLE_HSTS=true
HSTS_MAX_AGE=31536000
ENABLE_FRAME_DENY=true
ENABLE_XSS_PROTECTION=true
ENABLE_CONTENT_TYPE_NOSNIFF=true

# -----------------------------------
# Monitoring & Alerting (Production)
# -----------------------------------
# REQUIRED: Production monitoring

# Sentry error tracking (required for production)
SENTRY_DSN=CHANGE_ME_https_your_sentry_dsn_here
SENTRY_ENVIRONMENT=production
SENTRY_TRACES_SAMPLE_RATE=0.05
SENTRY_ENABLED=true

# CloudWatch logging
CLOUDWATCH_LOG_GROUP=/aws/ecs/ai-video-prod
CLOUDWATCH_LOG_STREAM_PREFIX=backend
CLOUDWATCH_ENABLED=true

# Health checks
HEALTH_CHECK_PATH=/health
HEALTH_CHECK_TIMEOUT=5

# Metrics
ENABLE_METRICS=true
METRICS_PORT=9090

# Performance monitoring
ENABLE_PERFORMANCE_MONITORING=true
SLOW_QUERY_THRESHOLD_MS=1000
SLOW_REQUEST_THRESHOLD_MS=5000

# -----------------------------------
# Feature Flags (Production)
# -----------------------------------
# MVP Features (enabled)
ENABLE_AD_PIPELINE=true
ENABLE_MUSIC_VIDEO_PIPELINE=true

# Post-MVP Features (controlled rollout)
ENABLE_TIMELINE_EDITOR=false
ENABLE_ADVANCED_TRANSITIONS=false
ENABLE_CUSTOM_FONTS=false
ENABLE_BATCH_PROCESSING=false
ENABLE_TEMPLATE_MARKETPLACE=false

# Experimental Features (disabled in production)
ENABLE_EXPERIMENTAL_MODELS=false
ENABLE_BETA_FEATURES=false

# -----------------------------------
# Frontend Configuration (Production)
# -----------------------------------
# Option B: FastAPI serves static files

FRONTEND_BUILD_PATH=/app/frontend/dist
SERVE_FRONTEND=true

# CDN for static assets (recommended for production)
FRONTEND_CDN_URL=https://CHANGE_ME_your_cdn_domain_if_using_cloudfront.cloudfront.net

# Aggressive static file caching
STATIC_FILE_CACHE_MAX_AGE=86400

# -----------------------------------
# Cost Optimization (Production)
# -----------------------------------
# Production uses higher quality models
USE_CHEAP_MODELS=false
MODEL_QUALITY_TIER=premium

# Clip generation limits (enforce to control costs)
MAX_CLIPS_PER_AD=5
MAX_CLIPS_PER_MUSIC_VIDEO=20
DEFAULT_CLIPS_PER_AD=4
DEFAULT_CLIPS_PER_MUSIC_VIDEO=12

# API optimization
BATCH_API_CALLS=true
MAX_BATCH_SIZE=10

# Asset reuse (cost savings)
ENABLE_ASSET_REUSE=true
ASSET_REUSE_SIMILARITY_THRESHOLD=0.92

# -----------------------------------
# Production Tools (Disabled)
# -----------------------------------
# Disable all development tools in production
HOT_RELOAD=false
AUTO_RELOAD=false

# API Documentation (disable in production for security)
ENABLE_DOCS=false
DOCS_URL=
REDOC_URL=
OPENAPI_URL=

# Debug endpoints (MUST be disabled)
ENABLE_DEBUG_ENDPOINTS=false
ENABLE_TEST_ENDPOINTS=false

# Database migrations (manual in production)
AUTO_MIGRATE=false
AUTO_CREATE_TABLES=false

# -----------------------------------
# Backup & Disaster Recovery
# -----------------------------------
# RDS automated backups
RDS_BACKUP_RETENTION_DAYS=7
RDS_BACKUP_WINDOW=03:00-04:00
RDS_MAINTENANCE_WINDOW=Mon:04:00-Mon:05:00

# S3 versioning (enable for disaster recovery)
S3_VERSIONING_ENABLED=true

# Database point-in-time recovery
RDS_POINT_IN_TIME_RECOVERY=true

# -----------------------------------
# Email/Notifications (Production)
# -----------------------------------
# REQUIRED: Production alerting

EMAIL_ENABLED=true
SMTP_HOST=CHANGE_ME_your_smtp_host
SMTP_PORT=587
SMTP_USER=CHANGE_ME_your_smtp_user
SMTP_PASSWORD=CHANGE_ME_your_smtp_password
SMTP_FROM_EMAIL=noreply@CHANGE_ME_your-domain.com
SMTP_USE_TLS=true

# Alert recipients (critical errors)
ALERT_EMAIL_RECIPIENTS=CHANGE_ME_admin@your-domain.com,CHANGE_ME_devops@your-domain.com

# -----------------------------------
# Slack Notifications (Production)
# -----------------------------------
# RECOMMENDED: Slack for real-time alerts

SLACK_WEBHOOK_URL=CHANGE_ME_https_hooks_slack_com_your_webhook
SLACK_CHANNEL=#production-alerts
SLACK_ENABLED=true

# Alert levels
SLACK_ALERT_ON_ERROR=true
SLACK_ALERT_ON_WARNING=false
SLACK_ALERT_ON_CRITICAL=true

# -----------------------------------
# Compliance & Audit
# -----------------------------------
# Enable audit logging
ENABLE_AUDIT_LOGGING=true
AUDIT_LOG_RETENTION_DAYS=90

# Data retention policies
USER_DATA_RETENTION_DAYS=365
VIDEO_RETENTION_DAYS=90
LOG_RETENTION_DAYS=30

# -----------------------------------
# Secrets Management
# -----------------------------------
# RECOMMENDED: Use AWS Secrets Manager for production

# AWS Secrets Manager ARN (optional but recommended)
# If set, secrets will be fetched from Secrets Manager
AWS_SECRETS_MANAGER_ARN=arn:aws:secretsmanager:us-east-1:CHANGE_ME_account_id:secret:ai-video-prod-CHANGE_ME

# Secret rotation
ENABLE_SECRET_ROTATION=true
SECRET_ROTATION_DAYS=90

# -----------------------------------
# Auto-Scaling Configuration
# -----------------------------------
# ECS auto-scaling settings

# Task count limits
ECS_MIN_TASK_COUNT=2
ECS_MAX_TASK_COUNT=10
ECS_DESIRED_TASK_COUNT=2

# Auto-scaling triggers
ECS_SCALE_UP_CPU_THRESHOLD=70
ECS_SCALE_DOWN_CPU_THRESHOLD=30
ECS_SCALE_UP_MEMORY_THRESHOLD=80
ECS_SCALE_DOWN_MEMORY_THRESHOLD=40

# -----------------------------------
# Cost Monitoring
# -----------------------------------
# AWS cost alerts
AWS_COST_ALERT_THRESHOLD_USD=1000
AWS_COST_ALERT_EMAIL=CHANGE_ME_billing@your-domain.com

# Replicate API cost tracking
REPLICATE_MONTHLY_BUDGET_USD=500
REPLICATE_ALERT_THRESHOLD_USD=400

# -----------------------------------
# Third-Party Integrations
# -----------------------------------
# Add production service credentials here

# Analytics (if applicable)
ANALYTICS_API_KEY=CHANGE_ME_production_analytics_key
ANALYTICS_ENABLED=true

# CDN (CloudFront, if applicable)
CDN_API_KEY=CHANGE_ME_if_needed
CDN_ENABLED=true
CDN_DISTRIBUTION_ID=CHANGE_ME_cloudfront_distribution_id

# -----------------------------------
# NOTES FOR PRODUCTION DEPLOYMENT
# -----------------------------------
# 1. Review ALL CHANGE_ME placeholders and replace with actual values
# 2. Use AWS Secrets Manager for sensitive credentials when possible
# 3. Enable all monitoring and alerting before going live
# 4. Test disaster recovery procedures
# 5. Set up automated backups for RDS and S3
# 6. Configure CloudWatch alarms for critical metrics
# 7. Enable AWS WAF if exposed to public internet
# 8. Review and test auto-scaling policies
# 9. Conduct security audit before production deployment
# 10. Document all configuration decisions
